tables:
  - name: "dws_tas_roster"
    description: "员工花名册（包含正式员工和外协）。包含 st_WrMonth 标识的历史版本。Employee roster table (employees and outsourced)."
    columns:
      - name: "st_EmpID"
        type: "VARCHAR(6)"
        description: "员工工号，6位数字。Employee ID, 6 digits. Primary Key."
      - name: "st_EmpNameCN"
        type: "VARCHAR(100)"
        description: "员工中文姓名。Employee Chinese Name."
      - name: "st_EmpNameEN"
        type: "VARCHAR(100)"
        description: "员工英文姓名。Employee English Name."
      - name: "st_WorkLocation"
        type: "VARCHAR(100)"
        description: "工作地点。Work Location."
      - name: "dt_HireDate"
        type: "DATETIME"
        description: "入职日期。Hire Date."
      - name: "d_YearsOfService"
        type: "FLOAT"
        description: "服务年限。Years of Service (e.g. 1.23)."
      - name: "st_EmpApproverName"
        type: "VARCHAR(100)"
        description: "一级审批人姓名。Level 1 Approver Name."
      - name: "st_FinalApproverName"
        type: "VARCHAR(100)"
        description: "二级审批人（终审人）姓名。Level 2 (Final) Approver Name."
      - name: "st_EmpAvailable"
        type: "VARCHAR(1)"
        description: "状态：'1'=在职, '0'=离职。Status: '1'=Active, '0'=Resigned."
      - name: "st_DeptName"
        type: "VARCHAR(100)"
        description: "部门/产品组名称。Department/Product Name (e.g., 3DI, CT, SPS, ES...)."
      - name: "st_LEOName"
        type: "VARCHAR(100)"
        description: "用工类型：L/E=正式, O*=外协, T=实习/临时。Employment Type."
      - name: "st_EMPBand"
        type: "VARCHAR(1)"
        description: "职级带宽（仅限正式员工）。Employee Band (Regular only)."
      - name: "st_OrgName"
        type: "VARCHAR(100)"
        description: "组织架构名称。Organization Name."
      - name: "st_OrgPICID"
        type: "VARCHAR(6)"
        description: "组织负责人ID。Organization PIC (Person In Charge) ID."
      - name: "st_OrgPICName"
        type: "VARCHAR(100)"
        description: "组织负责人姓名。Organization PIC Name."
      - name: "st_WrMonth"
        type: "VARCHAR(6)"
        description: "数据版本/月份 (YYYYMM)。Data Version (YYYYMM)."
      - name: "st_ClassName"
        type: "VARCHAR(8)"
        description: "岗位类别：FE=现场工程师, Sales=销售, Member=成员, Manager=经理, Temp=临时, Assistant=助理。Job Class."

  - name: "dws_wisdom_machine"
    description: "机台信息表。包含 st_WrMonth 标识的历史版本。Machine information table."
    columns:
      - name: "st_SN"
        type: "VARCHAR(255)"
        description: "机台序列号。Machine Serial Number. Primary Key."
      - name: "st_MachineWarrantyStatus"
        type: "VARCHAR(255)"
        description: "保修状态。Warranty Status."
      - name: "st_MachineSWLHModel"
        type: "VARCHAR(255)"
        description: "机台型号。Machine Model."
      - name: "st_MachineClusterFlag"
        type: "VARCHAR(255)"
        description: "类别：'R'=主机, 'C'=小室/Chamber。Type: 'R'=Main Machine, 'C'=Chamber."
      - name: "st_ProductLine"
        type: "VARCHAR(255)"
        description: "产品线。Product Line (e.g., 3DI, CT, SPS...)."
      - name: "st_BP"
        type: "VARCHAR(255)"
        description: "客户简称。Customer Name (Short)."
      - name: "st_Fab"
        type: "VARCHAR(255)"
        description: "客户厂房名称。Customer Fab Name."
      - name: "st_BU"
        type: "VARCHAR(255)"
        description: "业务单元。Business Unit."
      - name: "st_City"
        type: "VARCHAR(255)"
        description: "城市。City."
      - name: "st_Site"
        type: "VARCHAR(255)"
        description: "站点。Site (e.g., Hefei Site)."
      - name: "st_MachineModelName"
        type: "VARCHAR(255)"
        description: "机台型号名称。Machine Model Name."
      - name: "dt_MachineFactoryShippingDate"
        type: "DATETIME"
        description: "出厂日期。Factory Shipping Date."
      - name: "dt_MachineMoveInDate"
        type: "DATETIME"
        description: "搬入日期。Move-in Date."
      - name: "dt_MachineStartUpHardwareEndDate"
        type: "DATETIME"
        description: "硬件安装完成日期。Hardware Install End Date."
      - name: "dt_MachineWarrantyStartDate"
        type: "DATETIME"
        description: "保修开始日期。Warranty Start Date."
      - name: "dt_MachineWarrantyExpiryDate"
        type: "DATETIME"
        description: "保修截止日期。Warranty Expiry Date."
      - name: "st_WrMonth"
        type: "VARCHAR(6)"
        description: "数据版本/月份 (YYYYMM)。Data Version (YYYYMM)."

  - name: "dws_navi_SE_SUHourperTool_Realtime"
    description: "设备装机实时工时统计表。Real-time startup hours per tool."
    columns:
      - name: "st_FY"
        type: "VARCHAR(10)"
        description: "财年。Fiscal Year (e.g., FY26)."
      - name: "st_HalfFY"
        type: "VARCHAR(10)"
        description: "上下财年。Half Fiscal Year (e.g., FY26-2H)."
      - name: "st_Month"
        type: "VARCHAR(6)"
        description: "月份 (YYYYMM)。Month (e.g., 202601)."
      - name: "st_ProductLine"
        type: "VARCHAR(50)"
        description: "产品名称。Product Line (e.g., TS, FSI...)."
      - name: "st_sn_org_teamname"
        type: "VARCHAR(100)"
        description: "团队名称。Team Name."
      - name: "st_SN"
        type: "VARCHAR(50)"
        description: "设备序列号。Serial Number."
      - name: "d_StartupHour"
        type: "DECIMAL(10, 2)"
        description: "Startup工时。Startup Hours."
      - name: "d_PreWarrantyHour"
        type: "DECIMAL(10, 2)"
        description: "PreWarranty工时。Pre-warranty Hours."
      - name: "st_MachineMachineHistory"
        type: "VARCHAR(50)"
        description: "设备的履历。Machine History."
      - name: "st_SUFlag"
        type: "VARCHAR(20)"
        description: "设备装机的状态。SU Flag (e.g., UnderSU, TA)."

kpi_definitions:
  headcount:
    description: "在职人数统计。Total number of active employees (st_EmpAvailable='1')."
    table_name: "dws_tas_roster"
    time_column: "st_WrMonth"
    allowed_scopes: ["product", "organization", "individual"]
    scope_columns:
      organization: "st_OrgName"
      product: "st_DeptName"
      individual: "st_EmpID"
    sql_template: |
      SELECT COUNT(DISTINCT st_EmpID) 
      FROM dws_tas_roster 
      WHERE st_EmpAvailable = '1' 
      {conditions}
  
  fe_count:
    description: "FE人数统计, Field Engineer (FE) count. Keywords: FE, Field Engineer, FE人数, FE数量."
    table_name: "dws_tas_roster"
    time_column: "st_WrMonth"
    allowed_scopes: ["product", "organization", "individual"]
    scope_columns:
      organization: "st_OrgName"
      product: "st_DeptName"
      individual: "st_EmpID"
    sql_template: |
      SELECT COUNT(DISTINCT st_EmpID) 
      FROM dws_tas_roster 
      WHERE st_EmpAvailable = '1' 
      AND st_LEOName = 'E'
      {conditions}

  os_count:
    description: "OS人数统计, Outsourced Staff (OS) count. Keywords: OS, Outsourced, 外协人数, 外协数量."
    table_name: "dws_tas_roster"
    time_column: "st_WrMonth"
    allowed_scopes: ["product", "organization", "individual"]
    scope_columns:
      organization: "st_OrgName"
      product: "st_DeptName"
      individual: "st_EmpID"
    sql_template: |
      SELECT COUNT(DISTINCT st_EmpID) 
      FROM dws_tas_roster 
      WHERE st_EmpAvailable = '1' 
      AND st_LEOName LIKE 'O%'
      {conditions}

  machine_count:
    description: "机台数量统计, Total number of machines (st_MachineClusterFlag='R')."
    table_name: "dws_wisdom_machine"
    time_column: "st_WrMonth"
    allowed_scopes: ["product", "organization", "tools"]
    scope_columns:
      organization: "st_BU"
      product: "st_ProductLine"
      tools: "st_SN"
    sql_template: |
      SELECT COUNT(DISTINCT st_SN) 
      FROM dws_wisdom_machine 
      WHERE st_MachineClusterFlag = 'R'
      {conditions}

  chamber_count:
    description: "Chamber数量统计。Total number of chambers (st_MachineClusterFlag='C')."
    table_name: "dws_wisdom_machine"
    time_column: "st_WrMonth"
    allowed_scopes: ["product", "organization", "tools"]
    scope_columns:
      organization: "st_BU"
      product: "st_ProductLine"
      tools: "st_SN"
    sql_template: |
      SELECT COUNT(DISTINCT st_SN) 
      FROM dws_wisdom_machine 
      WHERE st_MachineClusterFlag = 'C'
      {conditions}

  startup_hours:
    description: "设备装机工时统计。Startup and Pre-warranty hours summary."
    table_name: "dws_navi_SE_SUHourperTool_Realtime"
    time_column: "st_Month"
    allowed_scopes: ["product", "organization", "tools"]
    scope_columns:
      product: "st_ProductLine"
      organization: "st_sn_org_teamname"
      tools: "st_SN"
    sql_template: |
      SELECT 
        SUM(d_StartupHour) as total_startup_hours,
        SUM(d_PreWarrantyHour) as total_prewarranty_hours
      FROM dws_navi_SE_SUHourperTool_Realtime 
      WHERE st_MachineMachineHistory = 'New' 
      AND st_SUFlag = 'TA' 
      {conditions}

  su_hour_per_tool:
    description: "每机台装机时间 (SU Hour per Tool)。Keywords: SU Hour per Tool, 平均每台装机结果, Startup Hour per Tool."
    table_name: "dws_navi_SE_SUHourperTool_Realtime"
    time_column: "st_Month"
    allowed_scopes: ["product", "organization", "tools"]
    scope_columns:
      product: "st_ProductLine"
      organization: "st_sn_org_teamname"
      tools: "st_SN"
    sql_template: |
      SELECT 
        round(SUM(d_StartupHour) + SUM(d_PreWarrantyHour), 2) / NULLIF(COUNT(DISTINCT st_SN), 2) as 'SUHourperTool' 
      FROM dws_navi_SE_SUHourperTool_Realtime 
      WHERE st_MachineMachineHistory = 'New' 
        AND st_SUFlag = 'TA' 
      {conditions}

example_sqls:
  - question: "FY26的SU Hour per Tool结果是多少？"
    sql: "SELECT SUM(d_StartupHour) + SUM(d_PreWarrantyHour) as 'Hour', COUNT(DISTINCT st_SN) as 'Sets', (SUM(d_StartupHour) + SUM(d_PreWarrantyHour)) / NULLIF(COUNT(DISTINCT st_SN), 0) as 'SUHourperTool' FROM dws_navi_SE_SUHourperTool_Realtime WHERE st_MachineMachineHistory = 'New' AND st_SUFlag = 'TA' AND st_FY = 'FY26'"
  
  - question: "FY26 CTSPS的平均每台的装机结果是多少？"
    sql: "SELECT (SUM(d_StartupHour) + SUM(d_PreWarrantyHour)) / NULLIF(COUNT(DISTINCT st_SN), 0) as 'SUHourperTool' FROM dws_navi_SE_SUHourperTool_Realtime WHERE st_MachineMachineHistory = 'New' AND st_SUFlag = 'TA' AND st_FY = 'FY26' AND (st_ProductLine = 'CT' OR st_ProductLine = 'SPS')"
  - question: "How many active employees are there?"
    sql: "SELECT COUNT(DISTINCT st_EmpID) FROM dws_tas_roster WHERE st_EmpAvailable = '1' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_tas_roster)"
  
  - question: "CT有多少FE"
    sql: "SELECT COUNT(DISTINCT st_EmpID) FROM dws_tas_roster WHERE st_ClassName = 'FE' AND st_DeptName = 'CT' AND st_EmpAvailable = '1' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_tas_roster)"
  
  - question: "Show me the headcount for 3DI department."
    sql: "SELECT COUNT(DISTINCT st_EmpID) FROM dws_tas_roster WHERE st_EmpAvailable = '1' AND st_DeptName = '3DI' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_tas_roster)"

  - question: "How many machines in Hefei?"
    sql: "SELECT COUNT(DISTINCT st_SN) FROM dws_wisdom_machine WHERE st_MachineClusterFlag = 'R' AND st_City LIKE '%合肥%' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_wisdom_machine)"

  - question: "List all FEs in SPS department."
    sql: "SELECT st_EmpNameCN, st_EmpID FROM dws_tas_roster WHERE st_ClassName = 'FE' AND st_DeptName = 'SPS' AND st_EmpAvailable = '1' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_tas_roster)"
  
  - question: "Count of machines by product line."
    sql: "SELECT st_ProductLine, COUNT(DISTINCT st_SN) as cnt FROM dws_wisdom_machine WHERE st_MachineClusterFlag = 'R' AND st_WrMonth = (SELECT MAX(st_WrMonth) FROM dws_wisdom_machine) GROUP BY st_ProductLine"
